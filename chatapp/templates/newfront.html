<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ì¡°ëª… ì œì–´ íŒ¨ë„ - 4ê°œ ê·¸ë£¹ UI</title>
<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --muted:#9aa4b2;
    --accent:#ffd166;
    --accent-2:#ffb703;
    --btn-bg:#142033;
    --btn-active:#1f7a8c;
    --radius:12px;
    --gap:10px;
    font-family: "Noto Sans KR", sans-serif;
  }
  body{
    margin:0;
    background:linear-gradient(180deg,var(--bg),#08101a);
    color:#e6eef6;
    display:flex;
    justify-content:center;
    padding:20px;
  }
  .wrap{
    width:100%;
    max-width:420px;
    background:rgba(10,15,25,0.6);
    border-radius:16px;
    padding:16px;
    box-shadow:0 10px 30px rgba(2,6,12,0.5);
    backdrop-filter:blur(6px);
  }
  h2{
    margin:16px 0 8px 0;
    font-size:15px;
    color:var(--accent);
    border-bottom:1px solid rgba(255,255,255,0.1);
    padding-bottom:4px;
  }
  /* ë²„íŠ¼ ê³µí†µ */
  button{
    all:unset;
    box-sizing:border-box;
    cursor:pointer;
    border-radius:var(--radius);
    background:var(--btn-bg);
    text-align:center;
    color:#fff;
    font-size:14px;
    padding:12px;
    transition:all .12s ease;
    border:1px solid rgba(255,255,255,0.05);
  }
  button:active{transform:scale(0.97)}
  button.active{
    background:linear-gradient(180deg,#1f7a8c,#18485a);
    box-shadow:0 0 10px rgba(31,122,140,0.4);
  }
  /* ê·¸ë¦¬ë“œ ê·¸ë£¹ */
  .grid{
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:var(--gap);
  }
  /* ì¡°ëª… ë°ê¸° (ê°€ë¡œ ìŠ¤í¬ë¡¤) */
  .scroll{
    display:flex;
    gap:10px;
    overflow-x:auto;
    padding-bottom:8px;
  }
  .scroll button{
    min-width:64px;
    flex:0 0 auto;
  }
  .scroll::-webkit-scrollbar{height:6px}
  .scroll::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.1);border-radius:6px}
  /* í•˜ë‹¨ ê³ ì • ë²„íŠ¼ */
  .bottom-bar{
    position:fixed;
    bottom:16px;
    left:50%;
    transform:translateX(-50%);
    width:calc(100% - 40px);
    max-width:420px;
    display:flex;
    gap:10px;
  }
  .fab{
    flex:1;
    height:52px;
    background:linear-gradient(90deg,#2e7a4f,#1b8f66);
    border:none;
    border-radius:14px;
    color:white;
    font-weight:600;
  }
  .fab.off{background:linear-gradient(90deg,#7a2a2a,#862f2f);}
</style>
</head>
<body>
  <div class="wrap">
    <h2>ì´ë²¤íŠ¸ ì œì–´</h2>
    <div class="grid" id="buttons">
      <button data-text="sp 02.bin">ëœë¤</button>
      <button data-text="sp 06.bin">íŒŒë„íƒ€ê¸°</button>
      <button data-text="sp 07.bin">ë°ê¸° ì œì–´</button>
      <button data-text="sp 08.bin">ë¬¸ì</button>
      <button data-text="sp 09.bin">íŠ¸ìœ™í´</button>
      <button data-text="sp 11.bin">ì¹´ìš´íŠ¸ë‹¤ìš´</button>
      <button data-text="sp 12.bin">ì „ì²´ ON/OFF</button>
    </div>

    <h2>ì‚¬ìš©ì ê°œë³„ ì œì–´</h2>
    <div class="grid" id="buttons">
      <button data-text="sp 14.bin">ì²œì²œíˆ ì ë“±</button>
      <button data-text="sp 15.bin">ì²œì²œíˆ ì†Œë“±</button>
    </div>

    <h2>ì¡°ëª… ë°ê¸° ì œì–´</h2>
    <div class="scroll" id="buttons">
      <!-- 11ë‹¨ê³„ -->
      <button data-text="sp 16.bin">100%</button>
      <button data-text="sp 17.bin">90%</button>
      <button data-text="sp 18.bin">80%</button>
      <button data-text="sp 19.bin">70%</button>
      <button data-text="sp 20.bin">60%</button>
      <button data-text="sp 21.bin">50%</button>
      <button data-text="sp 22.bin">40%</button>
      <button data-text="sp 23.bin">30%</button>
      <button data-text="sp 24.bin">20%</button>
      <button data-text="sp 25.bin">10%</button>
      <button data-text="sp 26.bin">0%</button>
    </div>

    <h2>ì¡°ëª… ì²˜ë¦¬ ì œì–´</h2>
    <div class="grid" id="buttons">
      <button data-text="sp 27.bin">ì²œì²œíˆ ì ë“±</button>
      <button data-text="sp 28.bin">ì¦‰ì‹œ ì ë“±</button>
      <button data-text="sp 29.bin">ì²œì²œíˆ ì†Œë“±</button>
      <button data-text="sp 30.bin">ì¦‰ì‹œ ì†Œë“±</button>
    </div>
    <!-- í´ë§ í† ê¸€ ë²„íŠ¼ -->
    <h2>í´ë§ ì œì–´</h2>
    <div style="text-align: center;" id="poll-control">
      <button id="poll-toggle" style="width: 90%;">í´ë§ OFF</button>
      <pre style="width: 90%; margin: 0 auto;" id="result">ready</pre>
      <pre style="width: 90%; margin: 0 auto;" id="status">ready</pre>
    </div>


  </div>

<script>
  const SERVER_URL = "{{ server_url|default:'http://127.0.0.1:8000/' }}";
  const baseUrl = SERVER_URL.endsWith("/") ? SERVER_URL : SERVER_URL + "/";
  const sendUrl = baseUrl + "send/";
  const statusUrl = baseUrl + "status/";

  const host = "mobile";
  const resultBox = document.getElementById("result");
  const statusBox = document.getElementById("status");

  // ì „ì†¡ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
  document.querySelectorAll("#buttons button").forEach(btn => {
      btn.addEventListener("click", async () => {
          const text = btn.dataset.text;
          try {
              const response = await fetch(sendUrl, {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({ host, text })
              });
              const data = await response.json().catch(() => null);

              if (!response.ok) {
                  const msg = data?.error || response.statusText;
                  resultBox.innerText = `âŒ ì˜¤ë¥˜ ë°œìƒ (${text}): HTTP ${response.status} - ${msg}`;
                  return;
              }

              resultBox.innerText = `âœ… [${text}] ì „ì†¡ ê²°ê³¼:\n` + JSON.stringify(data, null, 2);
          } catch (err) {
              resultBox.innerText = `âŒ ìš”ì²­ ì‹¤íŒ¨ (${text}): ${err}`;
          }
      });
  });

  // í´ë§
  let pollInterval = null;

  async function pollStatus() {
      try {
          const res = await fetch(statusUrl);
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const data = await res.json();
          statusBox.innerText = `ğŸ“¡ ì„œë²„ ìƒíƒœ (${new Date().toLocaleTimeString()}):\n`
              + JSON.stringify(data, null, 2);
      } catch (err) {
          statusBox.innerText = `âš ï¸ ìƒíƒœ ìš”ì²­ ì‹¤íŒ¨: ${err}`;
      }
  }

  // í´ë§ í† ê¸€ ë²„íŠ¼
  const pollToggleBtn = document.getElementById("poll-toggle");
  pollToggleBtn.addEventListener("click", () => {
      if (pollInterval) {
          clearInterval(pollInterval);
          pollInterval = null;
          pollToggleBtn.innerText = "í´ë§ OFF";
      } else {
          pollStatus();
          pollInterval = setInterval(pollStatus, 1000);
          pollToggleBtn.innerText = "í´ë§ ON";
      }
  });

</script>
<script>
  // ëª¨ë“  ë²„íŠ¼ (4ê°œ ê·¸ë£¹ ì „ì²´)
  const allButtons = document.querySelectorAll( "#buttons button" );

  let selectedButton = null;

  allButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      // ì´ë¯¸ ì„ íƒëœ ë²„íŠ¼ì„ ë‹¤ì‹œ í´ë¦­í•œ ê²½ìš°
      if (btn === selectedButton) {
        // ì¼ë‹¨ í•´ì œ
        btn.classList.remove('active');
        console.log('í•´ì œ:', btn.textContent);

        // ì ì‹œ í›„ ë‹¤ì‹œ ì„ íƒ (0.2ì´ˆ í›„)
        setTimeout(() => {
          btn.classList.add('active');
          console.log('ë‹¤ì‹œ ì„ íƒ:', btn.textContent);
        }, 200);

        return;
      }

      // ë‹¤ë¥¸ ë²„íŠ¼ í´ë¦­ ì‹œ ì´ì „ ì„ íƒ í•´ì œ
      if (selectedButton) selectedButton.classList.remove('active');

      // ìƒˆ ë²„íŠ¼ ì„ íƒ
      btn.classList.add('active');
      selectedButton = btn;
      console.log('ì„ íƒ:', btn.textContent);
    });
  });
</script>

</body>
</html>
